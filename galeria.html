<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Añadimos metadatos para evitar caché -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Galería - Ecosistemas terrestres en Cuba</title>
    <!-- Añadimos un parámetro de versión al CSS -->
    <link rel="stylesheet" href="./css/thesis-style.css?v=1.2" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Resto de estilos sin cambios -->
    <style>
      /* Tus estilos existentes sin cambios */
    </style>
  </head>
  <body>
    <!-- Particle container -->
    <div id="particles"></div>

    <nav class="navbar">
      <!-- Navegación sin cambios -->
    </nav>

    <div class="container">
      <div class="content-box">
        <h1>Galería de Imágenes - Ecosistemas terrestres en Cuba</h1>

        <div class="loading" id="loading">Cargando imágenes...</div>
        <div class="gallery" id="gallery">
          <!-- Las imágenes se cargarán dinámicamente aquí -->
        </div>
      </div>
    </div>

    <!-- Lightbox para ver imágenes ampliadas -->
    <div class="lightbox" id="lightbox">
      <!-- Contenido del lightbox sin cambios -->
    </div>

    <script>
      // Navegación (sin cambios)
      
      // Sistema de partículas (sin cambios)
      
      // Modificamos la función loadAllImages para asegurar que las imágenes se carguen con un timestamp
      function loadAllImages() {
        const gallery = document.getElementById("gallery");
        const loading = document.getElementById("loading");

        // Limpiar el mensaje de carga
        loading.style.display = "none";

        // Limpiar la galería
        gallery.innerHTML = "";

        // Lista de todas las imágenes con timestamp para evitar caché
        const timestamp = new Date().getTime();
        const imageFiles = [];
        
        // Generar dinámicamente las 38 imágenes
        for (let i = 819; i <= 856; i++) {
          const num = i.toString().padStart(4, '0');
          imageFiles.push({
            path: `./imgs/IMG-20250506-WA${num}.jpg?v=${timestamp}`,
            name: `Ecosistema ${i - 818}`
          });
        }

        // Contador para verificar cuántas imágenes se cargaron correctamente
        let loadedImages = 0;
        let failedImages = 0;
        let totalImages = imageFiles.length;

        // Crear elementos para cada imagen
        imageFiles.forEach((image, index) => {
          const item = document.createElement("div");
          item.className = "gallery-item";

          const img = document.createElement("img");
          img.src = image.path;
          img.alt = image.name;
          img.dataset.index = index;

          // Manejar carga exitosa de imagen
          img.onload = function () {
            loadedImages++;
            if (loadedImages + failedImages === totalImages) {
              console.log(
                `Imágenes cargadas: ${loadedImages}, Fallidas: ${failedImages}`
              );
            }
          };

          // Manejar errores de carga de imagen
          img.onerror = function () {
            console.log("Error al cargar: " + image.path);
            failedImages++;

            // Crear un canvas como reemplazo para la imagen
            const canvas = document.createElement("canvas");
            canvas.width = 300;
            canvas.height = 250;
            const ctx = canvas.getContext("2d");

            // Dibujar un fondo gris con texto
            ctx.fillStyle = "#e0e0e0";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#666666";
            ctx.font = "16px Arial";
            ctx.textAlign = "center";
            ctx.fillText(
              "Imagen no disponible",
              canvas.width / 2,
              canvas.height / 2
            );

            // Usar el canvas como imagen
            img.src = canvas.toDataURL();

            if (loadedImages + failedImages === totalImages) {
              console.log(
                `Imágenes cargadas: ${loadedImages}, Fallidas: ${failedImages}`
              );
            }
          };

          item.appendChild(img);
          gallery.appendChild(item);

          // Abrir lightbox al hacer clic en la imagen
          img.addEventListener("click", () => {
            const visibleImages = Array.from(
              document.querySelectorAll(".gallery-item img")
            ).map((img) => ({
              path: img.src,
              name: img.alt,
            }));

            // Encontrar el índice actual en las imágenes visibles
            const currentIndex = visibleImages.findIndex(
              (img) => img.path === image.path
            );
            openLightbox(currentIndex >= 0 ? currentIndex : 0, visibleImages);
          });
        });
      }

      // Resto de funciones sin cambios
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Añade esto justo antes del cierre del body -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const galleryContainer = document.querySelector('.gallery-container');
            if (!galleryContainer) {
                console.error('No se encontró el contenedor de la galería');
                return;
            }
            
            // Limpiar el contenedor existente
            galleryContainer.innerHTML = '';
            
            // Añadir las 38 imágenes dinámicamente
            for (let i = 819; i <= 856; i++) {
                const imgNumber = i.toString().padStart(4, '0');
                const imgSrc = `imgs/IMG-20250506-WA${imgNumber}.jpg`;
                
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                
                const img = document.createElement('img');
                img.src = imgSrc;
                img.alt = `Imagen ${i - 818}`;
                img.onerror = function() {
                    console.warn(`No se pudo cargar la imagen: ${imgSrc}`);
                    this.parentNode.style.display = 'none';
                };
                
                galleryItem.appendChild(img);
                galleryContainer.appendChild(galleryItem);
            }
        });
    </script>
    </body>
    </html>
    <!-- Resto del head sin cambios -->
  </head>
  <body>
    <!-- Resto del código sin cambios -->
  </body>
</html>
